 EXPLAIN select supp_nation, cust_nation, l_year, sum(volume) as revenue from ( select n1.n_name as supp_nation, n2.n_name as cust_nation, extract(year from l_shipdate) as l_year, l_extendedprice * (1 - l_discount) as volume from supplier, lineitem, orders, customer, nation n1, nation n2 where s_suppkey = l_suppkey and o_orderkey = l_orderkey and c_custkey = o_custkey and s_nationkey = n1.n_nationkey and c_nationkey = n2.n_nationkey and ( (n1.n_name = 'IRAN' and n2.n_name = 'ARGENTINA') or (n1.n_name = 'ARGENTINA' and n2.n_name = 'IRAN') ) and l_shipdate between date '1995-01-01' and date '1996-12-31' ) as shipping group by supp_nation, cust_nation, l_year order by supp_nation, cust_nation, l_year;
                                                                                      QUERY PLAN                                                                                       
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Finalize GroupAggregate  (cost=863797.48..866781.61 rows=10004 width=68)
   Group Key: n1.n_name, n2.n_name, (date_part('year'::text, (lineitem.l_shipdate)::timestamp without time zone))
   ->  Gather Merge  (cost=863797.48..866431.51 rows=20004 width=68)
         Workers Planned: 2
         ->  Partial GroupAggregate  (cost=862797.46..863122.53 rows=10002 width=68)
               Group Key: n1.n_name, n2.n_name, (date_part('year'::text, (lineitem.l_shipdate)::timestamp without time zone))
               ->  Sort  (cost=862797.46..862822.47 rows=10002 width=68)
                     Sort Key: n1.n_name, n2.n_name, (date_part('year'::text, (lineitem.l_shipdate)::timestamp without time zone))
                     ->  Hash Join  (cost=29888.03..862132.93 rows=10002 width=68)
                           Hash Cond: (orders.o_custkey = customer.c_custkey)
                           Join Filter: (((n1.n_name = 'IRAN'::bpchar) AND (n2.n_name = 'ARGENTINA'::bpchar)) OR ((n1.n_name = 'ARGENTINA'::bpchar) AND (n2.n_name = 'IRAN'::bpchar)))
                           ->  Nested Loop  (cost=1805.63..832714.66 rows=240346 width=42)
                                 ->  Hash Join  (cost=1805.20..591822.28 rows=240346 width=42)
                                       Hash Cond: (lineitem.l_suppkey = supplier.s_suppkey)
                                       ->  Parallel Seq Scan on lineitem  (cost=0.00..576347.41 rows=3004322 width=20)
                                             Filter: ((l_shipdate >= '1995-01-01'::date) AND (l_shipdate <= '1996-12-31'::date))
                                       ->  Hash  (cost=1765.20..1765.20 rows=3200 width=30)
                                             ->  Hash Join  (cost=1.40..1765.20 rows=3200 width=30)
                                                   Hash Cond: (supplier.s_nationkey = n1.n_nationkey)
                                                   ->  Seq Scan on supplier  (cost=0.00..1273.00 rows=40000 width=8)
                                                   ->  Hash  (cost=1.38..1.38 rows=2 width=30)
                                                         ->  Seq Scan on nation n1  (cost=0.00..1.38 rows=2 width=30)
                                                               Filter: ((n_name = 'IRAN'::bpchar) OR (n_name = 'ARGENTINA'::bpchar))
                                 ->  Index Scan using orders_pkey on orders  (cost=0.43..1.00 rows=1 width=8)
                                       Index Cond: (o_orderkey = lineitem.l_orderkey)
                           ->  Hash  (cost=27482.40..27482.40 rows=48000 width=30)
                                 ->  Hash Join  (cost=1.40..27482.40 rows=48000 width=30)
                                       Hash Cond: (customer.c_nationkey = n2.n_nationkey)
                                       ->  Seq Scan on customer  (cost=0.00..20119.00 rows=600000 width=8)
                                       ->  Hash  (cost=1.38..1.38 rows=2 width=30)
                                             ->  Seq Scan on nation n2  (cost=0.00..1.38 rows=2 width=30)
                                                   Filter: ((n_name = 'ARGENTINA'::bpchar) OR (n_name = 'IRAN'::bpchar))
(32 rows)

